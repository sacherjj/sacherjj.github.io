<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bencoding (encoding of a .torrent file)</title>
  <meta name="author" content="" />

  

  
  <meta name="description" content="My little piece of the web.">	
  

  <meta name="generator" content="Hugo 0.30.2" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="http://www.joesacher.com/css/animate.css" rel="stylesheet">

  
  
    <link href="http://www.joesacher.com/css/style.default.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="http://www.joesacher.com/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="http://www.joesacher.com/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="http://www.joesacher.com/img/apple-touch-icon.png" />

  




  <link rel="alternate" href="http://www.joesacher.com/index.xml" type="application/rss+xml" title="joesacher.com">

  
  <meta property="og:title" content="Bencoding (encoding of a .torrent file)" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/blog/2010/12/21/bencoding//" />
  <meta property="og:image" content="img/logo.png" />

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="http://www.joesacher.com/">
                    <img src="http://www.joesacher.com/img/logo.png" alt="Bencoding (encoding of a .torrent file) logo" class="hidden-xs hidden-sm">
                    <img src="http://www.joesacher.com/img/logo-small.png" alt="Bencoding (encoding of a .torrent file) logo" class="visible-xs visible-sm">
                    <span class="sr-only">Bencoding (encoding of a .torrent file) - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Bencoding (encoding of a .torrent file)</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">
                <div class="row">
                    
                    <div class="col-md-9" id="blog-post">
                        
                        <p class="text-muted mb-small text-right text-uppercase">
                            December 21, 2010<br/>
                            <i class="fa fa-clock-o"></i> 7 min. read</p>

                            <div id="post-content">
                                
                                

<p>The Bencode format is an interesting design.  It is byte based, which makes it safe from big-endian and little-endian translations.  Somewhere when reading about how torrents worked, I got looking at their file format.</p>

<p>As far as I know, the Bencode format isn&rsquo;t used on anything but torrent files.  The format is pretty simple, with only 4 different data structures: Byte String, Integer, List, and Dictionary.</p>

<h2 id="bencode-basics">Bencode Basics</h2>

<h3 id="byte-string">Byte String</h3>

<p>This is formatted as <code>[integer length]:[byte string]</code>.  Simply read the length number of bytes following the colon.</p>

<h3 id="integer">Integer</h3>

<p>The integer type is structured as <code>i[contents]e</code>. Contents can be positive or negative integer, without leading zeros.</p>

<p>Valid examples: <code>i-1234e</code>  <code>i1234e</code></p>

<h3 id="list">List</h3>

<p>The list type (or array if you like) is formatted as <code>l[contents]e</code>.  Contents will be any valid Bencode types just appended together.</p>

<h3 id="dictionary">Dictionary</h3>

<p>The dictionary type (also know as a hash or an associative array) is formatted as <code>d[contents]e</code>.  Contents includes <code>[key][value]</code> pairs until termination.  The key value must always be a byte string, but the value may be any Bencode type (even another dictionary).</p>

<h2 id="the-code">The Code</h2>

<p>It is possible to store complex structures with these simple types.  I enjoyed learning the format by creating a Python class for encoding and decoding data in Bencode format.</p>

<p>The source code for this class is available <a href="https://github.com/sacherjj/bencode">on my github</a>.</p>

<p>I have been using Python for quite a while as a scripting language, but only recently started trying to create proper classes and develop more advanced OO designed applications with Python.  I&rsquo;m sure this isn&rsquo;t purely Pythonic and would welcome any criticism and ways to improve.</p>

<p>I wanted to call out a few things in the code that were good learning experiences for me.</p>

<h3 id="encoding-methods">Encoding Methods</h3>

<p>Functions are objects in Python and can be stored and referenced just like data.  In the internal encoding function <code>_local_encode</code>, I&rsquo;m storing the various data type encode methods in a dictonary with data type string as key.  This allows me to get data type string with <code>type(data).__name__</code>.  If the key exists in the dictonary, I envoke that method to process the data.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_local_encode</span>(self, data):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Returns the proper Bencoded string for data given &#34;&#34;&#34;</span>
    encoders <span style="color:#555">=</span> {<span style="color:#c30"></span><span style="color:#c30">&#39;dict&#39;</span>: self<span style="color:#555">.</span>_encode_dictionary,
                <span style="color:#c30"></span><span style="color:#c30">&#39;list&#39;</span>: self<span style="color:#555">.</span>_encode_list,
                <span style="color:#c30"></span><span style="color:#c30">&#39;tuple&#39;</span>: self<span style="color:#555">.</span>_encode_list,
                <span style="color:#c30"></span><span style="color:#c30">&#39;str&#39;</span>: self<span style="color:#555">.</span>_encode_string,
                <span style="color:#c30"></span><span style="color:#c30">&#39;int&#39;</span>: self<span style="color:#555">.</span>_encode_integer,
                <span style="color:#c30"></span><span style="color:#c30">&#39;float&#39;</span>: self<span style="color:#555">.</span>_encode_float}
    data_type <span style="color:#555">=</span> <span style="color:#366">type</span>(data)<span style="color:#555">.</span>__name__
    <span style="color:#069;font-weight:bold">if</span> data_type <span style="color:#000;font-weight:bold">in</span> encoders<span style="color:#555">.</span>keys():
        <span style="color:#069;font-weight:bold">return</span> encoders[data_type](data)
    <span style="color:#069;font-weight:bold">else</span>:
        <span style="color:#069;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">Exception</span>(<span style="color:#c30"></span><span style="color:#c30">&#39;Encoder is not defined for data type: </span><span style="color:#a00">%s</span><span style="color:#c30">&#39;</span> <span style="color:#555">%</span> data_type)</code></pre></div>

<p>String encoding is very simple, just joining length of the string with the data.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#99f">@staticmethod</span>
<span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_encode_string</span>(data):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Converts string to Bencoded Byte String &#34;&#34;&#34;</span>
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30"></span><span style="color:#c30">&#39;</span><span style="color:#a00">%d</span><span style="color:#c30">:</span><span style="color:#a00">%s</span><span style="color:#c30">&#39;</span> <span style="color:#555">%</span> (<span style="color:#366">len</span>(data), data)</code></pre></div>

<p>Encoding integer is just wrapping <code>i</code> and <code>e</code> around the string conversion of the integer.  Since bencode does not encode floats, those are converted to ints.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#99f">@staticmethod</span>
<span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_encode_integer</span>(data):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Converts Integer to Bencoded Integer string &#34;&#34;&#34;</span>
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30"></span><span style="color:#c30">&#39;i</span><span style="color:#a00">%d</span><span style="color:#c30">e&#39;</span> <span style="color:#555">%</span> data

<span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_encode_float</span>(self, data):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Converts Float to Bencoded Integer string &#34;&#34;&#34;</span>
    <span style="color:#069;font-weight:bold">return</span> self<span style="color:#555">.</span>_encode_integer(<span style="color:#366">int</span>(data))</code></pre></div>

<p>List encoding performs recursive calls into _local_encode as it loops through the list, just appending items.  I optimised with lists instead of string concatenation.  Originally, I built this with the ben variable as a string and += calls, which is terrible for memory performance.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_encode_list</span>(self, data):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Converts List or Tuple to Bencoded List string &#34;&#34;&#34;</span>
    ben <span style="color:#555">=</span> [<span style="color:#c30"></span><span style="color:#c30">&#39;l&#39;</span>]
    <span style="color:#069;font-weight:bold">for</span> item <span style="color:#000;font-weight:bold">in</span> data:
        ben<span style="color:#555">.</span>append(self<span style="color:#555">.</span>_local_encode(item))
    ben<span style="color:#555">.</span>append(<span style="color:#c30"></span><span style="color:#c30">&#39;e&#39;</span>)
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30"></span><span style="color:#c30">&#39;&#39;</span><span style="color:#555">.</span>join(ben)</code></pre></div>

<p>Dictionary works the same way as list, just appending the generated values from _local_encode with the addition of a string in front.  Again, this was changed from string concatenation to list append.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_encode_dictionary</span>(self, data):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Converts Dictionary to Bencoded Dictionary String &#34;&#34;&#34;</span>
    ben <span style="color:#555">=</span> [<span style="color:#c30"></span><span style="color:#c30">&#39;d&#39;</span>]
    <span style="color:#069;font-weight:bold">for</span> key <span style="color:#000;font-weight:bold">in</span> <span style="color:#366">sorted</span>(data<span style="color:#555">.</span>keys()):
        ben<span style="color:#555">.</span>append(self<span style="color:#555">.</span>_encode_string(key))
        ben<span style="color:#555">.</span>append(self<span style="color:#555">.</span>_local_encode(data[key]))
    ben<span style="color:#555">.</span>append(<span style="color:#c30"></span><span style="color:#c30">&#39;e&#39;</span>)
    <span style="color:#069;font-weight:bold">return</span><span style="color:#c30"></span><span style="color:#c30">&#39;&#39;</span><span style="color:#555">.</span>join(ben)</code></pre></div>

<p>This came out simpler and cleaner than I expected for encoding.  But it is a really simple format, so it shouldn&rsquo;t be too complex.</p>

<h3 id="decoding-methods">Decoding Methods</h3>

<p>For my external decode method, I&rsquo;m using a class level pointer for the bencoded string and walking through it.  I setup those two variables and call into _local_decode.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">decode</span>(self, ben_string):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Returns the data structure defined by the Bencoded string &#34;&#34;&#34;</span>
    <span style="color:#069;font-weight:bold">try</span>:
        self<span style="color:#555">.</span>_ben_string <span style="color:#555">=</span> ben_string
        self<span style="color:#555">.</span>_pointer <span style="color:#555">=</span> <span style="color:#f60">0</span>
        <span style="color:#069;font-weight:bold">return</span> self<span style="color:#555">.</span>_local_decode()
    <span style="color:#069;font-weight:bold">except</span> <span style="color:#c00;font-weight:bold">IndexError</span> <span style="color:#069;font-weight:bold">as</span> e:
        <span style="color:#069;font-weight:bold">print</span>(<span style="color:#c30"></span><span style="color:#c30">&#34;Index Error at Pointer = </span><span style="color:#a00">%d</span><span style="color:#c30"> of </span><span style="color:#a00">%d</span><span style="color:#c30;font-weight:bold">\n</span><span style="color:#a00">%s</span><span style="color:#c30">&#34;</span> <span style="color:#555">%</span> (self<span style="color:#555">.</span>_pointer, <span style="color:#366">len</span>(self<span style="color:#555">.</span>_ben_string), <span style="color:#366">str</span>(e)))</code></pre></div>

<p>While I thought I might use the dictonary mapped methods again, I couldn&rsquo;t find a clean way to handle the 11 possible cases for integer.  So, I decided to just just go old school flow control.  This is one situation that I would have used a switch statement with an else case if it was available in Python.  If you have a more Pythonic way of doing this, please ley me know!</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_local_decode</span>(self):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; Detects and returns the proper Bencoded data type starting at current Pointer position &#34;&#34;&#34;</span>
    cur_char <span style="color:#555">=</span> self<span style="color:#555">.</span>_ben_string[self<span style="color:#555">.</span>_pointer]
    <span style="color:#069;font-weight:bold">if</span> cur_char <span style="color:#555">==</span> <span style="color:#c30"></span><span style="color:#c30">&#39;i&#39;</span>:
        <span style="color:#069;font-weight:bold">return</span> self<span style="color:#555">.</span>_parse_integer()
    <span style="color:#069;font-weight:bold">elif</span> cur_char <span style="color:#555">==</span> <span style="color:#c30"></span><span style="color:#c30">&#39;l&#39;</span>:
        <span style="color:#069;font-weight:bold">return</span> self<span style="color:#555">.</span>_parse_list()
    <span style="color:#069;font-weight:bold">elif</span> cur_char <span style="color:#555">==</span> <span style="color:#c30"></span><span style="color:#c30">&#39;d&#39;</span>:
        <span style="color:#069;font-weight:bold">return</span> self<span style="color:#555">.</span>_parse_dictionary()
    <span style="color:#069;font-weight:bold">elif</span> cur_char <span style="color:#000;font-weight:bold">in</span> (<span style="color:#c30"></span><span style="color:#c30">&#39;-&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;0&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;1&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;2&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;3&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;4&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;5&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;6&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;7&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;8&#39;</span>, <span style="color:#c30"></span><span style="color:#c30">&#39;9&#39;</span>):
        <span style="color:#069;font-weight:bold">return</span> self<span style="color:#555">.</span>_parse_byte_string()
    <span style="color:#069;font-weight:bold">else</span>:
        <span style="color:#069;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">Exception</span>(<span style="color:#c30"></span><span style="color:#c30">&#39;Invalid character detected at position </span><span style="color:#a00">%d</span><span style="color:#c30"> : </span><span style="color:#a00">%s</span><span style="color:#c30">&#39;</span> <span style="color:#555">%</span> (self<span style="color:#555">.</span>_pointer, <span style="color:#366">str</span>(cur_char)))</code></pre></div>

<p>Before we get into Integer and String decoding, we have a helper function.  Both the Integer and the String will have a certain number of characters to parse into an integer.
The only difference is the stop character.  For the String, this is the length of the string with &lsquo;:&rsquo; end character.  For the Integer, this is the actual data value with &lsquo;e&rsquo; end character.<br />
You will see this method called from both decode methods.  Note that the int() parsing handles the leading &lsquo;-&rsquo; fine for negative integers.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_get_number</span>(self, end_char):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; 
</span><span style="color:#c30">    Returns number in string up to termination character given. 
</span><span style="color:#c30">    &#34;&#34;&#34;</span>
    
    start_pointer <span style="color:#555">=</span> self<span style="color:#555">.</span>_pointer
    <span style="color:#069;font-weight:bold">while</span> self<span style="color:#555">.</span>_ben_string[self<span style="color:#555">.</span>_pointer] <span style="color:#555">!=</span> end_char:
        self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> <span style="color:#f60">1</span>
    num <span style="color:#555">=</span> <span style="color:#366">int</span>(self<span style="color:#555">.</span>_ben_string[start_pointer:self<span style="color:#555">.</span>_pointer])  <span style="color:#09f;font-style:italic"># Parse int</span>
    self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> <span style="color:#f60">1</span>  <span style="color:#09f;font-style:italic"># Consume the end_char</span>
    <span style="color:#069;font-weight:bold">return</span> num</code></pre></div>

<p>The only job of the integer decode method is to consume the leading character that doesn&rsquo;t exist in the string integer.  Then all the work is turned over to the _get_number method above up to the &lsquo;e&rsquo; character.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_parse_integer</span>(self):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; 
</span><span style="color:#c30">    Parses a Bencoded Integer type of format i&lt;number&gt;e
</span><span style="color:#c30">    &#34;&#34;&#34;</span>
    self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> <span style="color:#f60">1</span>  <span style="color:#09f;font-style:italic"># Consume the &#39;i&#39; start character</span>
    <span style="color:#069;font-weight:bold">return</span> self<span style="color:#555">.</span>_get_number(<span style="color:#c30"></span><span style="color:#c30">&#39;e&#39;</span>)</code></pre></div>

<p>The String decoding gets the length integer this the helper function up to the &lsquo;:&rsquo; character.  Then it gets the string for return, and increments the pointer past the string.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_parse_byte_string</span>(self):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34;
</span><span style="color:#c30">    Parses a Bencoded Byte String type of format &lt;len&gt;:&lt;byte string&gt; 
</span><span style="color:#c30">    &#34;&#34;&#34;</span>

    str_len <span style="color:#555">=</span> self<span style="color:#555">.</span>_get_number(<span style="color:#c30"></span><span style="color:#c30">&#39;:&#39;</span>)
    byte_string <span style="color:#555">=</span> self<span style="color:#555">.</span>_ben_string[self<span style="color:#555">.</span>_pointer:self<span style="color:#555">.</span>_pointer <span style="color:#555">+</span> str_len]
    self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> str_len  <span style="color:#09f;font-style:italic"># Consume the byte string</span>
    <span style="color:#069;font-weight:bold">return</span> byte_string</code></pre></div>

<p>The list starts with &lsquo;l&rsquo; and ends with &lsquo;e&rsquo;.  So we move the pointer to consume the &lsquo;l&rsquo;, then we loop until the current pointer character is an &lsquo;e&rsquo;.  Each time through the while,
the class level pointer might increment quite a bit, as data items are consumed.  However, we are not at the end of the list until we see a letter &lsquo;e&rsquo;.</p>

<p>For each list item, much like the recursive encoding, we call _local_decode to return us whatever the data is.</p>

<p>Since it is the responsibility of all the decoding methods to consume their bytes, we increment the pointer to move past the list termination &lsquo;e&rsquo; at the end.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_parse_list</span>(self):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; 
</span><span style="color:#c30">    Parses a Bencoded List type of format l&lt;contents&gt;e
</span><span style="color:#c30">    
</span><span style="color:#c30">    All members of the list as simply appended together in Bencode format to make up &lt;contents&gt;
</span><span style="color:#c30">    &#34;&#34;&#34;</span>
    self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> <span style="color:#f60">1</span>  <span style="color:#09f;font-style:italic"># Consume the &#39;l&#39; start character</span>
    val <span style="color:#555">=</span> []
    
    <span style="color:#069;font-weight:bold">while</span> self<span style="color:#555">.</span>_ben_string[self<span style="color:#555">.</span>_pointer] <span style="color:#555">!=</span> <span style="color:#c30"></span><span style="color:#c30">&#39;e&#39;</span>:
        val<span style="color:#555">.</span>append(self<span style="color:#555">.</span>_local_decode())
    
    self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> <span style="color:#f60">1</span> <span style="color:#09f;font-style:italic"># Consume the &#39;e&#39; termination character</span>
    <span style="color:#069;font-weight:bold">return</span> val</code></pre></div>

<p>This is very similar to list processing, with the addition of the key.  We know that the key is required to be a byte string, so we call directly to that method.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">_parse_dictionary</span>(self):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34;    Parses a Bencoded Dictionary type of format d&lt;pairs&gt;e
</span><span style="color:#c30">
</span><span style="color:#c30">    All pairs consist of ByteString key followed by any valid data type
</span><span style="color:#c30">    &#34;&#34;&#34;</span>
    self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> <span style="color:#f60">1</span>  <span style="color:#09f;font-style:italic"># Consume the &#39;d&#39; start character</span>
    be_dict <span style="color:#555">=</span> {}
    <span style="color:#069;font-weight:bold">while</span> self<span style="color:#555">.</span>_ben_string[self<span style="color:#555">.</span>_pointer] <span style="color:#555">!=</span> <span style="color:#c30"></span><span style="color:#c30">&#39;e&#39;</span>:
        key <span style="color:#555">=</span> self<span style="color:#555">.</span>_parse_byte_string()   <span style="color:#09f;font-style:italic"># Skipping local decode, because key must be a byte string</span>
        val <span style="color:#555">=</span> self<span style="color:#555">.</span>_local_decode()
        be_dict[key] <span style="color:#555">=</span> val
    self<span style="color:#555">.</span>_pointer <span style="color:#555">+=</span> <span style="color:#f60">1</span>  <span style="color:#09f;font-style:italic"># Consume the &#39;e&#39; termination character</span>
    <span style="color:#069;font-weight:bold">return</span> be_dict</code></pre></div>

<p>If you have a cleaner implementation you would like to share, please contact me.  I found the few iterations on this to be enjoyable and a good learning experience.</p>

<p>The code is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a></p>

                                
                             </div>
                        
                        
                        <div id="comments"><div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "joesachercom" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div>
                        

                    </div>
                    
                    

                    
                    <div class="col-md-3">
                        
<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Categories</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            <li><a href="http://www.joesacher.com/categories/cooking" class="text-uppercase">cooking (2)</a>
            </li><li><a href="http://www.joesacher.com/categories/how-to" class="text-uppercase">how-to (5)</a>
            </li><li><a href="http://www.joesacher.com/categories/personal" class="text-uppercase">personal (9)</a>
            </li><li><a href="http://www.joesacher.com/categories/reviews" class="text-uppercase">reviews (14)</a>
            </li><li><a href="http://www.joesacher.com/categories/tech" class="text-uppercase">tech (29)</a>
            </li><li><a href="http://www.joesacher.com/categories/trans-am" class="text-uppercase">trans-am (45)</a>
            </li>
        </ul>
    </div>
</div>

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Blog Series</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            <li><a href="http://www.joesacher.com/series/hugo" class="text-uppercase">hugo (4)</a>
            </li><li><a href="http://www.joesacher.com/series/python-tips" class="text-uppercase">python-tips (2)</a>
            </li><li><a href="http://www.joesacher.com/series/python-to-rust" class="text-uppercase">python-to-rust (4)</a>
            </li><li><a href="http://www.joesacher.com/series/trans-am" class="text-uppercase">trans-am (45)</a>
            </li>
        </ul>
    </div>
</div>
<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            <li><a href="http://www.joesacher.com/tags/android"><i class="fa fa-tags"></i> android</a>
            </li><li><a href="http://www.joesacher.com/tags/avr"><i class="fa fa-tags"></i> avr</a>
            </li><li><a href="http://www.joesacher.com/tags/bicycle"><i class="fa fa-tags"></i> bicycle</a>
            </li><li><a href="http://www.joesacher.com/tags/bicycle-touring"><i class="fa fa-tags"></i> bicycle-touring</a>
            </li><li><a href="http://www.joesacher.com/tags/book-review"><i class="fa fa-tags"></i> book-review</a>
            </li><li><a href="http://www.joesacher.com/tags/calendars"><i class="fa fa-tags"></i> calendars</a>
            </li><li><a href="http://www.joesacher.com/tags/comprehensions"><i class="fa fa-tags"></i> comprehensions</a>
            </li><li><a href="http://www.joesacher.com/tags/cooking"><i class="fa fa-tags"></i> cooking</a>
            </li><li><a href="http://www.joesacher.com/tags/cycling"><i class="fa fa-tags"></i> cycling</a>
            </li><li><a href="http://www.joesacher.com/tags/dessert"><i class="fa fa-tags"></i> dessert</a>
            </li><li><a href="http://www.joesacher.com/tags/dry-bag"><i class="fa fa-tags"></i> dry-bag</a>
            </li><li><a href="http://www.joesacher.com/tags/ebooks"><i class="fa fa-tags"></i> ebooks</a>
            </li><li><a href="http://www.joesacher.com/tags/electronics"><i class="fa fa-tags"></i> electronics</a>
            </li><li><a href="http://www.joesacher.com/tags/enumerate"><i class="fa fa-tags"></i> enumerate</a>
            </li><li><a href="http://www.joesacher.com/tags/fiction"><i class="fa fa-tags"></i> fiction</a>
            </li><li><a href="http://www.joesacher.com/tags/film-making"><i class="fa fa-tags"></i> film-making</a>
            </li><li><a href="http://www.joesacher.com/tags/google"><i class="fa fa-tags"></i> google</a>
            </li><li><a href="http://www.joesacher.com/tags/hacking"><i class="fa fa-tags"></i> hacking</a>
            </li><li><a href="http://www.joesacher.com/tags/ham-radio"><i class="fa fa-tags"></i> ham-radio</a>
            </li><li><a href="http://www.joesacher.com/tags/hugo"><i class="fa fa-tags"></i> hugo</a>
            </li><li><a href="http://www.joesacher.com/tags/humor"><i class="fa fa-tags"></i> humor</a>
            </li><li><a href="http://www.joesacher.com/tags/hvac"><i class="fa fa-tags"></i> hvac</a>
            </li><li><a href="http://www.joesacher.com/tags/inspiration"><i class="fa fa-tags"></i> inspiration</a>
            </li><li><a href="http://www.joesacher.com/tags/javascript"><i class="fa fa-tags"></i> javascript</a>
            </li><li><a href="http://www.joesacher.com/tags/lathes"><i class="fa fa-tags"></i> lathes</a>
            </li><li><a href="http://www.joesacher.com/tags/marriage"><i class="fa fa-tags"></i> marriage</a>
            </li><li><a href="http://www.joesacher.com/tags/navigation"><i class="fa fa-tags"></i> navigation</a>
            </li><li><a href="http://www.joesacher.com/tags/nonfiction"><i class="fa fa-tags"></i> nonfiction</a>
            </li><li><a href="http://www.joesacher.com/tags/pannier"><i class="fa fa-tags"></i> pannier</a>
            </li><li><a href="http://www.joesacher.com/tags/personal"><i class="fa fa-tags"></i> personal</a>
            </li><li><a href="http://www.joesacher.com/tags/photography"><i class="fa fa-tags"></i> photography</a>
            </li><li><a href="http://www.joesacher.com/tags/pizza"><i class="fa fa-tags"></i> pizza</a>
            </li><li><a href="http://www.joesacher.com/tags/podcasts"><i class="fa fa-tags"></i> podcasts</a>
            </li><li><a href="http://www.joesacher.com/tags/programming"><i class="fa fa-tags"></i> programming</a>
            </li><li><a href="http://www.joesacher.com/tags/projects"><i class="fa fa-tags"></i> projects</a>
            </li><li><a href="http://www.joesacher.com/tags/proposal"><i class="fa fa-tags"></i> proposal</a>
            </li><li><a href="http://www.joesacher.com/tags/python"><i class="fa fa-tags"></i> python</a>
            </li><li><a href="http://www.joesacher.com/tags/recipe"><i class="fa fa-tags"></i> recipe</a>
            </li><li><a href="http://www.joesacher.com/tags/recumbent"><i class="fa fa-tags"></i> recumbent</a>
            </li><li><a href="http://www.joesacher.com/tags/rust"><i class="fa fa-tags"></i> rust</a>
            </li><li><a href="http://www.joesacher.com/tags/safety"><i class="fa fa-tags"></i> safety</a>
            </li><li><a href="http://www.joesacher.com/tags/sewing"><i class="fa fa-tags"></i> sewing</a>
            </li><li><a href="http://www.joesacher.com/tags/strings"><i class="fa fa-tags"></i> strings</a>
            </li><li><a href="http://www.joesacher.com/tags/touchpad"><i class="fa fa-tags"></i> touchpad</a>
            </li><li><a href="http://www.joesacher.com/tags/touring"><i class="fa fa-tags"></i> touring</a>
            </li><li><a href="http://www.joesacher.com/tags/unicode"><i class="fa fa-tags"></i> unicode</a>
            </li><li><a href="http://www.joesacher.com/tags/video"><i class="fa fa-tags"></i> video</a>
            </li><li><a href="http://www.joesacher.com/tags/web"><i class="fa fa-tags"></i> web</a>
            </li><li><a href="http://www.joesacher.com/tags/webos"><i class="fa fa-tags"></i> webos</a>
            </li><li><a href="http://www.joesacher.com/tags/windows-phone"><i class="fa fa-tags"></i> windows-phone</a>
            </li><li><a href="http://www.joesacher.com/tags/woodworking"><i class="fa fa-tags"></i> woodworking</a>
            </li><li><a href="http://www.joesacher.com/tags/writing"><i class="fa fa-tags"></i> writing</a>
            </li>
        </ul>
    </div>
</div>

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        






<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2002-2017 - Joe Sacher - All Rights Reserved.</p>
            
            <p class="pull-right">A modified version of 
              template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>
              
              ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>




    </div>
    

    



<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-3718160-3', 'auto');
ga('send', 'pageview');
</script>


<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>

<script src="http://www.joesacher.com/js/hpneo.gmaps.js"></script>
<script src="http://www.joesacher.com/js/gmaps.init.js"></script>
<script src="http://www.joesacher.com/js/front.js"></script>


<script src="http://www.joesacher.com/js/owl.carousel.min.js"></script>




  </body>
</html>
