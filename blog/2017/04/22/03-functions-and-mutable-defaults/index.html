<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Python: Functions and Mutable Defaults</title>
  <meta name="author" content="" />

  

  
  <meta name="description" content="My little piece of the web.">	
  

  <meta name="generator" content="Hugo 0.30.2" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="http://www.joesacher.com/css/animate.css" rel="stylesheet">

  
  
    <link href="http://www.joesacher.com/css/style.default.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="http://www.joesacher.com/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="http://www.joesacher.com/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="http://www.joesacher.com/img/apple-touch-icon.png" />

  




  <link rel="alternate" href="http://www.joesacher.com/index.xml" type="application/rss+xml" title="joesacher.com">

  
  <meta property="og:title" content="Python: Functions and Mutable Defaults" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/blog/2017/04/22/03-functions-and-mutable-defaults//" />
  <meta property="og:image" content="img/logo.png" />

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="http://www.joesacher.com/">
                    <img src="http://www.joesacher.com/img/logo.png" alt="Python: Functions and Mutable Defaults logo" class="hidden-xs hidden-sm">
                    <img src="http://www.joesacher.com/img/logo-small.png" alt="Python: Functions and Mutable Defaults logo" class="visible-xs visible-sm">
                    <span class="sr-only">Python: Functions and Mutable Defaults - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Python: Functions and Mutable Defaults</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">
                <div class="row">
                    
                    <div class="col-md-9" id="blog-post">
                        
                        <p class="text-muted mb-small text-right text-uppercase">
                            April 22, 2017<br/>
                            <i class="fa fa-clock-o"></i> 11 min. read</p>

                            <div id="post-content">
                                <p class="series_top_page">This post is part of the <a href="http://www.joesacher.com//series/python-tips">Python Tips</a> series.</p>
                                

<p>Default arguments in Python allow you to make complex functions very easy to use.  They can be called with mostly defaults or called with as much configuration as needed.  This comes with a gotcha for those getting started in this.  If you use mutable data structures as defaults, things don&rsquo;t behave exactly as you would expect.</p>

<p>However, before we start, lets cover some things you may not know that I will use in the code.  And others that are just interesting and partially related.</p>

<h3 id="short-detour-into-args-and-kwargs">Short detour into *args and **kwargs</h3>

<p>Once we get done with all the detours, you will see <code>*items</code> as a parameter in the code below.  Prefixing an argument with a single <code>*</code> means that you will collect all unnamed parameters into an argument list.  If you have single arguments you wish to capture outside of this, they just need to appear prior to the catch all variable.  This is most commonly used with the term <code>*args</code> for <strong>arg</strong>ument<strong>s</strong>, which is fine if representing generic or various types of data.  However, I prefer to make a clearer name when possible.  So here is used <code>*items</code> as we are sending items of a list.</p>

<p>We are not using <code>**kwargs</code>, or the <code>**</code> style, but this is used to expand <strong>k</strong>ey <strong>w</strong>ord <strong>arg</strong>ument<strong>s</strong>.  So you can think of a dictionary being passed in.  Here is a function that takes key word arguments and just prints them up.  Notice how we are using <code>.items()</code> which is the same way to get (key, value) pairs out of a dictionary.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">my_function</span>(<span style="color:#555">**</span>kwargs):
    <span style="color:#069;font-weight:bold">for</span> (key, value) <span style="color:#000;font-weight:bold">in</span> kwargs<span style="color:#555">.</span>items():
        <span style="color:#069;font-weight:bold">print</span>(<span style="color:#c30"></span><span style="color:#c30">&#39;{} - {}&#39;</span><span style="color:#555">.</span>format(key, value))</code></pre></div>

<p>We can call this with two arguments and look at the output:</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">my_function(joe<span style="color:#555">=</span><span style="color:#c30"></span><span style="color:#c30">&#39;corny&#39;</span>, amy<span style="color:#555">=</span><span style="color:#c30"></span><span style="color:#c30">&#39;amazing&#39;</span>)</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">joe - corny
amy - amazing</code></pre></div>

<p>Lets go a little crazier:</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">my_function(a<span style="color:#555">=</span><span style="color:#f60">1</span>, b<span style="color:#555">=</span><span style="color:#f60">2</span>, c<span style="color:#555">=</span><span style="color:#f60">3</span>, ddddddd<span style="color:#555">=</span><span style="color:#f60">4</span>, i<span style="color:#555">=</span><span style="color:#c30"></span><span style="color:#c30">&#39;am&#39;</span>, getting<span style="color:#555">=</span><span style="color:#c30"></span><span style="color:#c30">&#39;tired&#39;</span>, of<span style="color:#555">=</span><span style="color:#c30"></span><span style="color:#c30">&#39;arguments&#39;</span>)</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">a - 1
b - 2
c - 3
ddddddd - 4
i - am
getting - tired
of - arguments</code></pre></div>

<h3 id="more-detour-forcing-named-arguments">More detour: Forcing named arguments</h3>

<p>New with Python 3 is the ability to force named arguments.  This means they must be entered with the name.  This is easiest to show with a few examples.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">print_label</span>(label_text, inverted, mirrored, flipped):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; function for printing label with many boolean args &#34;&#34;&#34;</span>
    <span style="color:#069;font-weight:bold">pass</span>

print_label(<span style="color:#c30"></span><span style="color:#c30">&#39;My Text&#39;</span>, False, True, False)</code></pre></div>

<p>While I would define the <code>print_label</code> function with good defaults for the last three arguments, I didn&rsquo;t want to here as I don&rsquo;t want you to think that forcing named arguments requires arguments with defaults.</p>

<p>If you saw that <code>print_label</code> call somewhere in code, how easy would it be to figure out what is going on?  Sure, you knew at the time you were coding as you just saw the definition or PyCharm popped up hints.</p>

<p>Just reading through source code, it will be impossible to understand.  <strong>This is bad</strong>.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">print_label</span>(label_text, <span style="color:#555">*</span>, inverted, mirrored, flipped):
    <span style="color:#c30"></span><span style="color:#c30">&#34;&#34;&#34; function for printing label with many boolean args &#34;&#34;&#34;</span>
    <span style="color:#069;font-weight:bold">pass</span>

print_label(<span style="color:#c30"></span><span style="color:#c30">&#39;My Text&#39;</span>, False, True, False)  <span style="color:#09f;font-style:italic"># Errors</span>
print_label(<span style="color:#c30"></span><span style="color:#c30">&#39;My Text&#39;</span>, inverted<span style="color:#555">=</span>False, mirrored<span style="color:#555">=</span>True, flipped<span style="color:#555">=</span>False)</code></pre></div>

<p>I have added an <code>*</code> argument that indicates a split between the positional arguments and named arguments.  If you are using a <code>*args</code>, you get this already.  The change in Python 3 is allowing this functionality without allowing unlimited positional arguments, as *args use would allow.</p>

<p>In the first call to <code>print_label</code> above, we would receive a TypeError that tells us <code>print_label() takes 1 positional argument but 4 were given</code>.   The second call will work properly.</p>

<p>Notice how the requirement of named parameters combined with good names, makes this call self documenting.  It is a little extra typing that is completely work the effort in readability.  Source code is read many more times than it is written.  All you are doing in the function definition is forcing programmers to be good source code citizens.</p>

<h3 id="last-detour-i-promise">Last detour, I promise</h3>

<p>Since we talked about <code>*</code> and <code>**</code> in receiving arguments to a function, I wanted to cover the idea of expanding lists and dictionaries.  The syntax is the same.  If you have a tuple with three items and wish to send those arguments into a function, you would just use <code>*tuple_var</code>.  This expands them into separate arguments.  Without this, you would be sending the tuple as the first argument.  This works the same for a list as a tuple.  For a dict, just use <code>**dict_var</code> to send named arguments in.</p>

<h3 id="back-to-default-mutability">Back to default mutability</h3>

<p>That was a deeper rabbit whole than I planned, but it was a good time to cover some of those points.  Lets build a function that allows you to add elements to a list, but create a fresh list if you don&rsquo;t provide one.  (Just act like the <code>list.extend()</code> method does not exist.)</p>

<p>Our first pass if we are new to Python might looks like this:</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">append_values</span>(<span style="color:#555">*</span>items, to_list<span style="color:#555">=</span>[]):
    <span style="color:#069;font-weight:bold">for</span> item <span style="color:#000;font-weight:bold">in</span> items:
        to_list<span style="color:#555">.</span>append(item)
    <span style="color:#069;font-weight:bold">return</span> to_list

list_a <span style="color:#555">=</span> append_values(<span style="color:#f60">1</span>, <span style="color:#f60">2</span>)
list_b <span style="color:#555">=</span> append_values(<span style="color:#f60">3</span>, <span style="color:#f60">4</span>, to_list<span style="color:#555">=</span>[])
list_c <span style="color:#555">=</span> append_values(<span style="color:#f60">5</span>, <span style="color:#f60">6</span>, to_list<span style="color:#555">=</span>[<span style="color:#f60">9</span>, <span style="color:#f60">10</span>])
list_d <span style="color:#555">=</span> append_values(<span style="color:#f60">7</span>, <span style="color:#f60">8</span>)</code></pre></div>

<p>Even people that don&rsquo;t know the dangers of mutable defaults in parameters will be able to determine the values of lists a through c.  However, many will not know what happens for list_d.</p>

<p><strong>list_a</strong> passes in two values, but no list to append onto.  So we start with the default empty list.  The output is what we would expect as <code>[1, 2]</code>.</p>

<p><strong>list_b</strong> passes in both values and an empty starting list.  So we would expect the output to be what it is: <code>[3, 4]</code>.</p>

<p><strong>list_c</strong> passes in a prepopulated list with values, so these are added at the end and we get <code>[9, 10, 5, 6]</code> as our output.</p>

<p><strong>list_d</strong> seems like it is exactly the same as list_a, but with different values.  We would expect to have an empty list as default and receive <code>[7, 8]</code> back.  However, we receive <code>[1, 2, 7, 8]</code> from append_values.</p>

<p>How is this possible, with the default values of <code>[]</code>?  Here is the issue with using mutable types as defaults.</p>

<p>When a function is created, Python keeps data related to it.  The default arguments are created and stored.  Each time the function is called, Python doesn&rsquo;t recreate it.  This would be wasteful.  It just looks at the values and uses them.  So this default list starts empty.  However, in the list_a call, we are using it and appending 1 and 2 into it.  list_b and list_c are not using the default, so these default values stay dormant.  list_d again uses the default list, which is not empty but <code>[1, 2]</code> from the list_a call.  This is why we get the values instead of an empty list.</p>

<h3 id="using-inspect">Using inspect</h3>

<p>Before we show how to keep this from happening, I want to show what is happening rather than forcing you to take my word for it.  For this I&rsquo;ll be using the inspect module that allows us to peek under the covers.</p>

<p>This is the same code as above, with a little more in it.  I&rsquo;m printing the values and displaying the values inside the function definition.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">import</span> <span style="color:#0cf;font-weight:bold">inspect</span>
<span style="color:#a00;background-color:#faa">â€‹</span>
<span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">append_values</span>(<span style="color:#555">*</span>items, to_list<span style="color:#555">=</span>[]):
    <span style="color:#069;font-weight:bold">for</span> item <span style="color:#000;font-weight:bold">in</span> items:
        to_list<span style="color:#555">.</span>append(item)
    <span style="color:#069;font-weight:bold">return</span> to_list

<span style="color:#069;font-weight:bold">print</span>(inspect<span style="color:#555">.</span>getfullargspec(append_values))</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">FullArgSpec(args=[], varargs=&#39;items&#39;, varkw=None, defaults=None, kwonlyargs=[&#39;to_list&#39;], kwonlydefaults={&#39;to_list&#39;: []}, annotations={})</code></pre></div>

<p>Before we start calling this function, I used inspect to print out the full argument specification just after the function was created.</p>

<ul>
<li><code>args</code> is empty, because we don&rsquo;t have any positional arguments that are not handled via the *items variable.  This is a list that would contain them otherwise.</li>
<li><code>varargs</code> is a string, as it can only hold one value (or be None).  There is only one variable that collects all left over positional arguments.</li>
<li><code>varkw</code> is None, as we don&rsquo;t have any <code>**</code> style named argument catchalls.</li>
<li><code>defaults</code> for positional arguments is None as we don&rsquo;t have any.</li>
<li><code>kwonlyargs</code> shows us our <code>to_list</code> keyword argument.</li>
<li><code>kwonlydefaults</code> is a dictionary that holds our default values for keywords.  Notice how we have <code>to_list</code> with a default of <code>[]</code>.</li>
<li><code>annotations</code> are functional annotations new in Python 3.  These are defined in <a href="https://www.python.org/dev/peps/pep-3107/">PEP 3107</a>.  I&rsquo;m not going to talk about them, but feel free to take a look.</li>
</ul>

<p>So with the initial state after the function is created, our <code>to_list</code> is <code>[]</code>.  Lets follow this through the executions.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_a <span style="color:#555">=</span> append_values(<span style="color:#f60">1</span>, <span style="color:#f60">2</span>)
<span style="color:#069;font-weight:bold">print</span>(list_a)
<span style="color:#069;font-weight:bold">print</span>(inspect<span style="color:#555">.</span>getfullargspec(append_values))</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[1, 2]
FullArgSpec(args=[], varargs=&#39;items&#39;, varkw=None, defaults=None, kwonlyargs=[&#39;to_list&#39;], kwonlydefaults={&#39;to_list&#39;: [1, 2]}, annotations={})</code></pre></div>

<p>We received <code>[1, 2]</code> as I discussed above for list_a.  However, looks at <code>kwonlydefault</code> ins the srgspec.  We are not <code>[1, 2]</code> instead of <code>[]</code>.  We have poisoned our pristine default.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_b <span style="color:#555">=</span> append_values(<span style="color:#f60">3</span>, <span style="color:#f60">4</span>, to_list<span style="color:#555">=</span>[])
<span style="color:#069;font-weight:bold">print</span>(list_b)
<span style="color:#069;font-weight:bold">print</span>(inspect<span style="color:#555">.</span>getfullargspec(append_values))</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[3, 4]
FullArgSpec(args=[], varargs=&#39;items&#39;, varkw=None, defaults=None, kwonlyargs=[&#39;to_list&#39;], kwonlydefaults={&#39;to_list&#39;: [1, 2]}, annotations={})</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_c <span style="color:#555">=</span> append_values(<span style="color:#f60">5</span>, <span style="color:#f60">6</span>, to_list<span style="color:#555">=</span>[<span style="color:#f60">9</span>, <span style="color:#f60">10</span>])
<span style="color:#069;font-weight:bold">print</span>(list_a)
<span style="color:#069;font-weight:bold">print</span>(inspect<span style="color:#555">.</span>getfullargspec(append_values))</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[1, 2]
FullArgSpec(args=[], varargs=&#39;items&#39;, varkw=None, defaults=None, kwonlyargs=[&#39;to_list&#39;], kwonlydefaults={&#39;to_list&#39;: [1, 2]}, annotations={})</code></pre></div>

<p>Since we passed in the list for both list_b and list_c, default was not touched.  However, we are still carrying around the mutated default to sting us in list_d.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_d <span style="color:#555">=</span> append_values(<span style="color:#f60">7</span>, <span style="color:#f60">8</span>)
<span style="color:#069;font-weight:bold">print</span>(list_a)
<span style="color:#069;font-weight:bold">print</span>(inspect<span style="color:#555">.</span>getfullargspec(append_values))</code></pre></div>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[1, 2, 7, 8]
FullArgSpec(args=[], varargs=&#39;items&#39;, varkw=None, defaults=None, kwonlyargs=[&#39;to_list&#39;], kwonlydefaults={&#39;to_list&#39;: [1, 2, 7, 8]}, annotations={})</code></pre></div>

<p>Not only did we pollute the output of list_d, but we have left more sunrises to any future callers.  This is the reason you never unintentionally use mutable variables (lists, dicts, objects) as default arguments.  They will be created once and continually mutated with calls.</p>

<p>So we have a major bug.  We need to fix it.  How will we know when we did?</p>

<h3 id="test-driven-development">Test Driven Development</h3>

<p>There is two ways to write code.  Code, then try to see if it works.  Or define what working is with tests, and code until it does work.</p>

<p>Yes, you read about how tests are good, but it is more work and you wind up just calling the function a few times with different data and calling it good.  The problem is you delete that sample code and move on.  How do we tell that it still works with changes?</p>

<p>Or worse, you just write the function and assume it works as we did above.  Now we have to figure out why we are getting weird bugs in production as almost everyone passes in a list, but occasionally they don&rsquo;t.</p>

<p>For all but the smallest programs, testing is lower overall effort and improves code quality.  Yes, it feels like more work, especially when deadlines are looming.  And it may be very hard with existing software.  However, untestable software is usually not modular enough for good code to begin with.  Just the act of testing makes you structure code into smaller and more predictable functions with fewer inter-related &lsquo;magic&rsquo;.  Getting in the habit early will make you a better developer.</p>

<p>Lecture over.  Lets write some tests.</p>

<p>For many modules that are built into Python, there is a better version of that functionality available in PyPi.  If you find an example for <code>urllib2</code> looks for a better one using <code>requests</code>.  <code>unittest</code> is built into Python.  Do yourself a favor and install <code>pytest</code> instead.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip3 install pytest</code></pre></div>

<p>See that was painless.</p>

<p>Lets use our examples and put those into tests.  On a larger project, I would have a separate testing directory with tests.  For simplicity, I&rsquo;ll put everything in one file here.  Below is what my <code>default-mutable.py</code> file looks like.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">append_values</span>(<span style="color:#555">*</span>items, to_list<span style="color:#555">=</span>[]):
    <span style="color:#069;font-weight:bold">for</span> item <span style="color:#000;font-weight:bold">in</span> items:
        to_list<span style="color:#555">.</span>append(item)
    <span style="color:#069;font-weight:bold">return</span> to_list


<span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">test_with_default</span>():
    list_a <span style="color:#555">=</span> append_values(<span style="color:#f60">1</span>, <span style="color:#f60">2</span>)
    <span style="color:#069;font-weight:bold">assert</span> list_a <span style="color:#555">==</span> [<span style="color:#f60">1</span>, <span style="color:#f60">2</span>]
    list_d <span style="color:#555">=</span> append_values(<span style="color:#f60">7</span>, <span style="color:#f60">8</span>)
    <span style="color:#069;font-weight:bold">assert</span> list_d <span style="color:#555">==</span> [<span style="color:#f60">7</span>, <span style="color:#f60">8</span>]


<span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">test_with_list</span>():
    list_b <span style="color:#555">=</span> append_values(<span style="color:#f60">3</span>, <span style="color:#f60">4</span>, to_list<span style="color:#555">=</span>[])
    <span style="color:#069;font-weight:bold">assert</span> list_b <span style="color:#555">==</span> [<span style="color:#f60">3</span>, <span style="color:#f60">4</span>]
    list_c <span style="color:#555">=</span> append_values(<span style="color:#f60">5</span>, <span style="color:#f60">6</span>, to_list<span style="color:#555">=</span>[<span style="color:#f60">9</span>, <span style="color:#f60">10</span>])
    <span style="color:#069;font-weight:bold">assert</span> list_c <span style="color:#555">==</span> [<span style="color:#f60">9</span>, <span style="color:#f60">10</span>, <span style="color:#f60">5</span>, <span style="color:#f60">6</span>]</code></pre></div>

<p>If I run this from the folder containing the file, I would use <code>pytest default-mutable.py</code>.  Here is the output:</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">C:\Users\micro\repositories\scratchpad&gt;pytest default-mutable.py
============================= test session starts =============================
platform win32 -- Python 3.6.3, pytest-3.2.5, py-1.5.2, pluggy-0.4.0
rootdir: C:\Users\micro\repositories\scratchpad, inifile:
collected 2 items

default-mutable.py F.

================================== FAILURES ===================================
______________________________ test_with_default ______________________________

    def test_with_default():
        list_a = append_values(1, 2)
        assert list_a == [1, 2]
        list_d = append_values(7, 8)
&gt;       assert list_d == [7, 8]
E       assert [1, 2, 7, 8] == [7, 8]
E         At index 0 diff: 1 != 7
E         Left contains more items, first extra item: 7
E         Use -v to get the full diff

default-mutable.py:11: AssertionError
===================== 1 failed, 1 passed in 0.08 seconds ======================</code></pre></div>

<p>We have an output of <code>F.</code> so we failed the first one and passed the second.  Notice the code is shown for the test and we see <code>[1, 2, 7, 8] == [7, 8]</code> as the failed assert.  This is what we saw with our manual testing.  Now we have a failing test that covers our problem.  Now lets fix the code and verify with passing tests.</p>

<h3 id="fixing-the-default-mutable-problem">Fixing the default mutable problem</h3>

<p>The best method for a default argument value is something that is easy to determine between a list with items and no list.  So if we use <code>None</code> as the default, it is easy to tell the difference.  However it forces us to handle the situation inside the function.</p>

<p>We will update out function to be the following:</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#069;font-weight:bold">def</span> <span style="color:#c0f">append_values</span>(<span style="color:#555">*</span>items, to_list<span style="color:#555">=</span>None):
    <span style="color:#069;font-weight:bold">if</span> to_list <span style="color:#000;font-weight:bold">is</span> None:
        to_list <span style="color:#555">=</span> []
    <span style="color:#069;font-weight:bold">for</span> item <span style="color:#000;font-weight:bold">in</span> items:
        to_list<span style="color:#555">.</span>append(item)
    <span style="color:#069;font-weight:bold">return</span> to_list</code></pre></div>

<p>If we have <code>None</code>, we are just creating a new empty list.  <code>None</code> is immutable, so it will not be polluted.  Lets rerun our tests.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">============================= test session starts =============================
platform win32 -- Python 3.6.3, pytest-3.2.5, py-1.5.2, pluggy-0.4.0
collected 2 items

default-mutable.py ..

========================== 2 passed in 0.03 seconds ===========================</code></pre></div>

<p>Well that certainly looks better.</p>

<h3 id="using-the-default-mutable-for-good">Using the default mutable for good</h3>

<p>Once you understand what is going on and how it works, this default mutable problem can be used for your goals.</p>

<p>Since the post has gotten fairly long, I&rsquo;m going to keep you hanging on this one until my next Python post.  For most people who have arrived after the next is posted, that just means clicking the next link below.</p>

                                <hr/>
        <p>Part 3 of 4
            in the <b>Python Tips</b> series.</p>
        <p><a href="http://www.joesacher.com/blog/2017/04/08/01-starting-tips/"><i class="fa fa-angle-left"></i>Series Start<i class="fa fa-angle-right"></i></a>
                     |
            <a href="http://www.joesacher.com/blog/2017/04/15/02-strings/"><i class="fa fa-angle-double-left"></i>Python: Strings</a>
                 |
        <a href="http://www.joesacher.com/blog/2017/05/20/04-mutable-defaults-and-decorators/">Python: Mutable Defaults and Decorators<i class="fa fa-angle-double-right"></i></a></p>
                             </div>
                        
                        
                        <div id="comments"><div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "joesachercom" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div>
                        

                    </div>
                    
                    

                    
                    <div class="col-md-3">
                        
<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Categories</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            <li><a href="http://www.joesacher.com/categories/cooking" class="text-uppercase">cooking (2)</a>
            </li><li><a href="http://www.joesacher.com/categories/how-to" class="text-uppercase">how-to (5)</a>
            </li><li><a href="http://www.joesacher.com/categories/personal" class="text-uppercase">personal (9)</a>
            </li><li><a href="http://www.joesacher.com/categories/reviews" class="text-uppercase">reviews (14)</a>
            </li><li><a href="http://www.joesacher.com/categories/tech" class="text-uppercase">tech (31)</a>
            </li><li><a href="http://www.joesacher.com/categories/trans-am" class="text-uppercase">trans-am (45)</a>
            </li>
        </ul>
    </div>
</div>

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Blog Series</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            <li><a href="http://www.joesacher.com/series/hugo" class="text-uppercase">hugo (4)</a>
            </li><li><a href="http://www.joesacher.com/series/python-tips" class="text-uppercase">python-tips (4)</a>
            </li><li><a href="http://www.joesacher.com/series/python-to-rust" class="text-uppercase">python-to-rust (4)</a>
            </li><li><a href="http://www.joesacher.com/series/trans-am" class="text-uppercase">trans-am (45)</a>
            </li>
        </ul>
    </div>
</div>
<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            <li><a href="http://www.joesacher.com/tags/android"><i class="fa fa-tags"></i> android</a>
            </li><li><a href="http://www.joesacher.com/tags/avr"><i class="fa fa-tags"></i> avr</a>
            </li><li><a href="http://www.joesacher.com/tags/bicycle"><i class="fa fa-tags"></i> bicycle</a>
            </li><li><a href="http://www.joesacher.com/tags/bicycle-touring"><i class="fa fa-tags"></i> bicycle-touring</a>
            </li><li><a href="http://www.joesacher.com/tags/book-review"><i class="fa fa-tags"></i> book-review</a>
            </li><li><a href="http://www.joesacher.com/tags/calendars"><i class="fa fa-tags"></i> calendars</a>
            </li><li><a href="http://www.joesacher.com/tags/comprehensions"><i class="fa fa-tags"></i> comprehensions</a>
            </li><li><a href="http://www.joesacher.com/tags/cooking"><i class="fa fa-tags"></i> cooking</a>
            </li><li><a href="http://www.joesacher.com/tags/cycling"><i class="fa fa-tags"></i> cycling</a>
            </li><li><a href="http://www.joesacher.com/tags/decorators"><i class="fa fa-tags"></i> decorators</a>
            </li><li><a href="http://www.joesacher.com/tags/dessert"><i class="fa fa-tags"></i> dessert</a>
            </li><li><a href="http://www.joesacher.com/tags/dry-bag"><i class="fa fa-tags"></i> dry-bag</a>
            </li><li><a href="http://www.joesacher.com/tags/ebooks"><i class="fa fa-tags"></i> ebooks</a>
            </li><li><a href="http://www.joesacher.com/tags/electronics"><i class="fa fa-tags"></i> electronics</a>
            </li><li><a href="http://www.joesacher.com/tags/enumerate"><i class="fa fa-tags"></i> enumerate</a>
            </li><li><a href="http://www.joesacher.com/tags/fiction"><i class="fa fa-tags"></i> fiction</a>
            </li><li><a href="http://www.joesacher.com/tags/film-making"><i class="fa fa-tags"></i> film-making</a>
            </li><li><a href="http://www.joesacher.com/tags/functions"><i class="fa fa-tags"></i> functions</a>
            </li><li><a href="http://www.joesacher.com/tags/google"><i class="fa fa-tags"></i> google</a>
            </li><li><a href="http://www.joesacher.com/tags/hacking"><i class="fa fa-tags"></i> hacking</a>
            </li><li><a href="http://www.joesacher.com/tags/ham-radio"><i class="fa fa-tags"></i> ham-radio</a>
            </li><li><a href="http://www.joesacher.com/tags/hugo"><i class="fa fa-tags"></i> hugo</a>
            </li><li><a href="http://www.joesacher.com/tags/humor"><i class="fa fa-tags"></i> humor</a>
            </li><li><a href="http://www.joesacher.com/tags/hvac"><i class="fa fa-tags"></i> hvac</a>
            </li><li><a href="http://www.joesacher.com/tags/inspiration"><i class="fa fa-tags"></i> inspiration</a>
            </li><li><a href="http://www.joesacher.com/tags/javascript"><i class="fa fa-tags"></i> javascript</a>
            </li><li><a href="http://www.joesacher.com/tags/lathes"><i class="fa fa-tags"></i> lathes</a>
            </li><li><a href="http://www.joesacher.com/tags/marriage"><i class="fa fa-tags"></i> marriage</a>
            </li><li><a href="http://www.joesacher.com/tags/navigation"><i class="fa fa-tags"></i> navigation</a>
            </li><li><a href="http://www.joesacher.com/tags/nonfiction"><i class="fa fa-tags"></i> nonfiction</a>
            </li><li><a href="http://www.joesacher.com/tags/pannier"><i class="fa fa-tags"></i> pannier</a>
            </li><li><a href="http://www.joesacher.com/tags/personal"><i class="fa fa-tags"></i> personal</a>
            </li><li><a href="http://www.joesacher.com/tags/photography"><i class="fa fa-tags"></i> photography</a>
            </li><li><a href="http://www.joesacher.com/tags/pizza"><i class="fa fa-tags"></i> pizza</a>
            </li><li><a href="http://www.joesacher.com/tags/podcasts"><i class="fa fa-tags"></i> podcasts</a>
            </li><li><a href="http://www.joesacher.com/tags/programming"><i class="fa fa-tags"></i> programming</a>
            </li><li><a href="http://www.joesacher.com/tags/projects"><i class="fa fa-tags"></i> projects</a>
            </li><li><a href="http://www.joesacher.com/tags/proposal"><i class="fa fa-tags"></i> proposal</a>
            </li><li><a href="http://www.joesacher.com/tags/python"><i class="fa fa-tags"></i> python</a>
            </li><li><a href="http://www.joesacher.com/tags/recipe"><i class="fa fa-tags"></i> recipe</a>
            </li><li><a href="http://www.joesacher.com/tags/recumbent"><i class="fa fa-tags"></i> recumbent</a>
            </li><li><a href="http://www.joesacher.com/tags/rust"><i class="fa fa-tags"></i> rust</a>
            </li><li><a href="http://www.joesacher.com/tags/safety"><i class="fa fa-tags"></i> safety</a>
            </li><li><a href="http://www.joesacher.com/tags/sewing"><i class="fa fa-tags"></i> sewing</a>
            </li><li><a href="http://www.joesacher.com/tags/strings"><i class="fa fa-tags"></i> strings</a>
            </li><li><a href="http://www.joesacher.com/tags/touchpad"><i class="fa fa-tags"></i> touchpad</a>
            </li><li><a href="http://www.joesacher.com/tags/touring"><i class="fa fa-tags"></i> touring</a>
            </li><li><a href="http://www.joesacher.com/tags/unicode"><i class="fa fa-tags"></i> unicode</a>
            </li><li><a href="http://www.joesacher.com/tags/video"><i class="fa fa-tags"></i> video</a>
            </li><li><a href="http://www.joesacher.com/tags/web"><i class="fa fa-tags"></i> web</a>
            </li><li><a href="http://www.joesacher.com/tags/webos"><i class="fa fa-tags"></i> webos</a>
            </li><li><a href="http://www.joesacher.com/tags/windows-phone"><i class="fa fa-tags"></i> windows-phone</a>
            </li><li><a href="http://www.joesacher.com/tags/woodworking"><i class="fa fa-tags"></i> woodworking</a>
            </li><li><a href="http://www.joesacher.com/tags/writing"><i class="fa fa-tags"></i> writing</a>
            </li>
        </ul>
    </div>
</div>

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        






<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2002-2017 - Joe Sacher - All Rights Reserved.</p>
            
            <p class="pull-right">A modified version of 
              template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>
              
              ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>




    </div>
    

    



<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-3718160-3', 'auto');
ga('send', 'pageview');
</script>


<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>

<script src="http://www.joesacher.com/js/hpneo.gmaps.js"></script>
<script src="http://www.joesacher.com/js/gmaps.init.js"></script>
<script src="http://www.joesacher.com/js/front.js"></script>


<script src="http://www.joesacher.com/js/owl.carousel.min.js"></script>




  </body>
</html>
